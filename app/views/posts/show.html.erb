<div class="container">
    <div class="detail">
        <%= image_tag @post.image ,class: "detail__image" %>
        <div class="likes">
          <h3 class="ml-3 pt-2 like-count"><%= @post.likes.count %>チルいいね！</h3>
          <% if user_signed_in?%>
         <% if current_user.already_liked?(@post) %>
         <div class="likes_button mb-3 ml-3">
          <label for="likes"><p><i class="far fa-heart"></i>チルいいね！</p></label>
          <%= button_to 'いいねを取り消す', post_like_path(@post), id: "likes",method: :delete %>
          </div>
        <% else %>
          <div class="likes_button mb-3 ml-3">
        <label for="likes"><p><i class="far fa-heart mr-2"></i>チルいいね！</p></label>
        <%= button_to 'いいね', post_likes_path(@post) , id:"likes"%>
           </div>
          <% end %>
          <% end %>
      
        </div>
        <p class="detail__text spot_name">スポット名：<%= @post.name%></p>
        <p class="detail__text spot_description"><%= @post.description%></p>
        <p class="detail__text spot_address">所在地：<%= @post.address%></p>
        <div id='map' class="map2"></div>
        <p id="position_show"><%= @post.latitude%></p>
        <p id="position_show2"><%= @post.longitude%></p>
        <h2 class="detail__text comments_all">コメント一覧</h2>
        <% if user_signed_in?%>
       <%= form_with(model:[@post,@comment], local: true) do |f| %>
        <div class="actions mt-5">
            <div class="field mt-5 comment_form">
                <%= f.label :text ,"コメントする" ,class:"mr-3"%>
                <%= f.text_field :text, autofocus: true, autocomplete: "name",class:"mr-3 comment_textarea"%>
                <%= f.submit "投稿" ,class:"mr-3"%>
        </div>
        </div>
       <% end %>
       <% end %>
        <div class="comments">

              <% @comments.each do |comment| %>
             <div class="comment">
            　　<p class="comment__content"><%= comment.text %></p>
            　　<div class="comment__user-info">
                <p class="comment__user-info__name mr-3"><%= comment.user.nickname %></p>
                <p class="comment__user-info__time"><%= comment.user.created_at.strftime("%Y-%m-%d %H:%M")
 %></p>
                </div>
             </div>
             <% end %>
            <%# <div class="comment">
            　　<p class="comment__content">すごいいい景色ですね</p>
            　　<div class="comment__user-info">
                <p class="comment__user-info__name">ますださん</p>
                <p class="comment__user-info__time">2020-02-22-00:00</p>
                </div>
            </div>
            <div class="comment">
            　　<p class="comment__content">すごいいい景色ですね</p>
            　　<div class="comment__user-info">
                <p class="comment__user-info__name">ますださん</p>
                <p class="comment__user-info__time">2020-02-22-00:00</p>
                </div>
            </div> %>
        </div>
</div>
<script>
let map 
let geocoder
let position = document.getElementById('position_show')
let position2 = document.getElementById('position_show2')
console.log(Number(position.innerHTML))
// 下の1行を追加 
const display = document.getElementById('display')

function initMap(){
  geocoder = new google.maps.Geocoder()

  map = new google.maps.Map(document.getElementById('map'), {
    center: {lat:Number(position.innerHTML), lng:Number(position2.innerHTML)},
    zoom: 16,
  });

  marker = new google.maps.Marker({
    position:{lat:Number(position.innerHTML), lng:Number(position2.innerHTML)},
    map: map
  });
}

function codeAddress(){
  let inputAddress = document.getElementById('address').value;

  geocoder.geocode( { 'address': inputAddress}, function(results, status) {
    if (status == 'OK') {
      map.setCenter(results[0].geometry.location);
      var marker = new google.maps.Marker({
          map: map,
          position: results[0].geometry.location
      });
      // 下の1行を追加 
      display.textContent = "検索結果：" + results[ 0 ].geometry.location
      let location = results[ 0 ].geometry.location
      var lat = location.lat();
      var lng = location.lng();    
      document.getElementById( "latitude" ).value = lat
       document.getElementById( "longitude" ).value = lng
  
    } else {
      alert('該当する結果がありませんでした：' + status);
    }
  });   
}
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=<%=ENV['GOOGLE_MAP_API_KEY']%>&callback=initMap" async defer></script>
